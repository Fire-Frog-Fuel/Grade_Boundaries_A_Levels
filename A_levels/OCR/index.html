<!doctype html>
<html lang="en">
  <head>
    <!-- ✨ SEO & performance enhancements for OCR page (no functional changes) ✨ -->
    <style id="css-cloak">
      html:not(.css-loaded) body > * {
        display: none;
      }
    </style>

    <!-- Preconnect hints for faster TTFB on third‑party assets -->
    <link rel="preconnect" href="https://plausible.io" />
    <link rel="preconnect" href="https://gc.zgo.at" />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    <link rel="preconnect" href="https://cdn.datatables.net" />
    <link rel="preconnect" href="https://code.jquery.com" />

    <!-- Analytics (kept) -->
    <script
      defer
      data-domain="gradeboundaries.com"
      src="https://plausible.io/js/script.js"
    ></script>
    <script
      data-goatcounter="https://gradeboundaries.goatcounter.com/count"
      async
      src="//gc.zgo.at/count.js"
    ></script>

    <!-- Base‑href and CSS injection (unchanged) -->
    <script>
      function uncloak() {
        document.documentElement.classList.add("css-loaded");
        const c = document.getElementById("css-cloak");
        if (c) c.remove();
      }
      const host = location.hostname;
      const myBase =
        host === "gradeboundaries.com" ? "/" : "/Grade_Boundaries_A_Levels/";
      const base = document.createElement("base");
      base.href = myBase;
      document.head.appendChild(base);
      const tail = document.createElement("link");
      tail.rel = "stylesheet";
      tail.href = "dist/output.css";
      document.head.appendChild(tail);
      const style = document.createElement("link");
      style.rel = "stylesheet";
      style.href = "style.css";
      style.onload = uncloak;
      document.head.appendChild(style);
    </script>

    <!-- Primary meta tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      OCR A‑Level Grade Boundaries 2015‑2025 | Interactive Tables & CSV
    </title>
    <meta
      name="description"
      content="Explore interactive tables, charts and downloadable CSVs of OCR A‑Level grade boundaries for exam sessions 2015‑2025."
    />
    <meta
      name="keywords"
      content="OCR grade boundaries, A Level grade thresholds, OCR 2025, exam results, UK A‑Levels"
    />
    <meta name="author" content="Fire-Frog-Fuel" />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#111827" />

    <!-- Canonical & hreflang -->
    <link rel="canonical" href="https://gradeboundaries.com/A_levels/OCR" />
    <link
      rel="alternate"
      hreflang="en-gb"
      href="https://gradeboundaries.com/A_levels/OCR"
    />
    <link
      rel="alternate"
      hreflang="x-default"
      href="https://gradeboundaries.com/A_levels/OCR"
    />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Grade-Boundary Explorer" />
    <meta property="og:locale" content="en_GB" />
    <meta property="og:url" content="https://gradeboundaries.com/A_levels/OCR" />
    <meta
      property="og:title"
      content="OCR A‑Level Grade Boundaries 2015‑2025 | Download CSV & Charts"
    />
    <meta
      property="og:description"
      content="Free interactive OCR grade‑boundary data (2015‑2025) with table view, trend charts & CSV download."
    />
    <meta
      property="og:image"
      content="https://gradeboundaries.com/preview.png"
    />
    <meta
      property="og:image:alt"
      content="Screenshot of OCR grade boundaries page"
    />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://gradeboundaries.com/A_levels/OCR" />
    <meta
      name="twitter:title"
      content="OCR A‑Level Grade Boundaries 2015‑2025"
    />
    <meta
      name="twitter:description"
      content="Interactive OCR grade‑boundary tables, charts & CSV download."
    />
    <meta
      name="twitter:image"
      content="https://gradeboundaries.com/preview.png"
    />

    <!-- Structured data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "OCR Grade Boundaries",
        "url": "https://gradeboundaries.com/A_levels/OCR",
        "breadcrumb": {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://gradeboundaries.com/"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "OCR",
              "item": "https://gradeboundaries.com/A_levels/OCR"
            }
          ]
        }
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Dataset",
        "name": "OCR A‑Level Grade Boundaries 2015‑2025",
        "description": "Dataset of OCR A‑Level grade‑boundary marks for all available units and exam sessions between 2015 and 2025.",
        "url": "https://gradeboundaries.com/A_levels/OCR",
        "keywords": [
          "OCR",
          "A Level",
          "grade boundaries",
          "2015",
          "2016",
          "2017",
          "2018",
          "2019",
          "2020",
          "2021",
          "2022",
          "2023",
          "2024",
          "2025"
        ],
        "temporalCoverage": "2015-01-01/2025-12-31",
        "isAccessibleForFree": true,
        "creator": {
          "@type": "Person",
          "name": "ChessMastermind",
          "url": "https://github.com/ChessMastermind"
        }
      }
    </script>

    <!-- Instant theme (kept) -->
    <script>
      (() => {
        const s = localStorage.getItem("theme");
        if (
          s === "dark" ||
          (!s && matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>

    <!-- ─── PERFORMANCE HINTS ─── -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    <link rel="preconnect" href="https://cdn.datatables.net" />
    <link rel="preconnect" href="https://code.jquery.com" />

    <!-- PapaParse -->
    <script
      src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"
      defer
    ></script>

    <!-- DataTables CSS (preload) -->
    <link
      rel="preload"
      href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
      as="style"
      onload="this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
    /></noscript>
    <link
      rel="preload"
      href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css"
      as="style"
      onload="this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css"
    /></noscript>

    <!-- Tailwind & other runtime JS left untouched -->
  </head>

  <body class="text-gray-800 flex flex-col min-h-screen">
    <header class="text-white text-center py-6 shadow-lg">
      <h1 class="page-title">OCR Grade Boundaries</h1>
      <button id="theme-toggle" class="absolute top-4 right-4">🌙</button>
      <nav
        class="mt-4 flex flex-col md:flex-row items-center justify-center gap-2"
        aria-label="Primary"
      >
        <a href="" class="nav-link mx-4 text-base sm:text-lg hover:text-white transition" title="Home">Home</a>
        <a
          href="A_levels/OCR"
          class="nav-link mx-4 text-base sm:text-lg hover:text-white transition"
          title="OCR A-Level grade boundaries 2015-2025"
          >OCR</a
        >
      </nav>
    </header>

    <main class="flex-1 w-full px-4">
      <section
        class="bg-white rounded-lg shadow-md p-6 w-full max-w-screen-2xl mx-auto"
      >
        <h2 class="text-2xl font-semibold mb-4">OCR Grade Boundaries</h2>

        <!-- ===== TABLE ===== -->
        <div class="table-wrapper mb-6">
          <table
            id="OCRTable"
            class="display nowrap responsive w-full"
            aria-describedby="grade-boundaries-caption"
          >
            <caption id="grade-boundaries-caption" class="sr-only">
              OCR grade boundaries per year / session / component / unit
            </caption>
            <thead>
              <tr></tr>
            </thead>
          </table>
        </div>

        <!-- ===== CSV DOWNLOAD ===== -->
        <div class="text-right my-4">
          <button
            id="downloadCSV"
            class="class-button px-4 py-2 rounded hover:bg-[#2b7a78] transition"
          >
            Download CSV
          </button>
        </div>

        <!-- ===== CONTROLS ===== -->
        <div id="ocr-controls" class="flex flex-wrap gap-4 mb-6 items-center">
          <label for="ocrCodeSearch" class="font-semibold">Code:</label>
          <input
            type="text"
            id="ocrCodeSearch"
            placeholder="e.g. H407"
            class="border rounded px-2 py-1 w-24 sm:w-auto"
            list="ocrCodeList"
          />
          <datalist id="ocrCodeList"></datalist>

          <label for="ocrComponentSearch" class="font-semibold"
            >Component&nbsp;(for&nbsp;graph):</label
          >
          <input
            type="text"
            id="ocrComponentSearch"
            placeholder="select component"
            class="border rounded px-2 py-1 w-24 sm:w-32"
            list="ocrComponentList"
            disabled
          />
          <datalist id="ocrComponentList"></datalist>
        </div>

        <!-- ===== CHART ===== -->
        <div class="chart-container">
          <canvas id="OCRChart"></canvas>
        </div>
      </section>
    </main>

    <!-- Footer -->
<footer class="mt-12" role="contentinfo">
      <div class="container mx-auto flex flex-col items-center py-6 px-4">
        <p class="text-lg">Created by</p>
        <nav aria-label="Created by">
          <ul class="flex space-x-4 text-lg">
            <li>
              <p>&nbsp;&nbsp;&nbsp;&nbsp;
              <a href="https://github.com/Fire-Frog-Fuel/" class="underline">
                Fire-Frog-Fuel
              </a></p>
            </li>
            <li>
              <span>&nbsp;and&nbsp;</span>
            </li>
            <li>
              <a href="https://github.com/ChessMastermind" class="underline">
                ChessMastermind
              </a>
            </li>
          </ul>
        </nav>

        <!-- Utility links -->
        <nav aria-label="Footer links">
          <ul class="flex space-x-4 text-lg">
            <li>
              <p>&nbsp;&nbsp;&nbsp;&nbsp;
              <a href="Contact" class="underline"> Contact us </a></p>
            </li>
            <li>
              <span>&nbsp;|&nbsp;</span>
            </li>
            <li>
              <a href="Privacy" class="underline"> Privacy Notice </a>
            </li>
          </ul>
        </nav>
      </div>
    </footer>
    <!-- ─── PAGE SCRIPT ─── -->
    <script defer>
      // Helper to load external scripts dynamically
      const loadScript = (src) =>
        new Promise((resolve) => {
          const s = document.createElement("script");
          s.src = src;
          s.onload = resolve;
          document.body.appendChild(s);
        });

      window.addEventListener("DOMContentLoaded", () => {
        fetch("csv/A_levels/OCR.csv")
          .then((r) => r.text())
          .then(
            (csvText) =>
              new Promise((resolve) => {
                Papa.parse(csvText, {
                  header: true,
                  dynamicTyping: true,
                  skipEmptyLines: true,
                  worker: true,
                  complete: ({ data }) => resolve([data, csvText]),
                });
              }),
          )
          .then(async ([parsed, csvText]) => {
            await loadScript("https://code.jquery.com/jquery-3.6.0.min.js");
            await loadScript(
              "https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js",
            ); // line 237
            await loadScript(
              "https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js",
            ); // line 238
            await loadScript("https://cdn.jsdelivr.net/npm/chart.js"); // line 239
            initPage(parsed, csvText);
          })
          .catch((err) => {
            console.error(err);
            document.getElementById("OCRTable").innerHTML =
              '<tbody><tr><td colspan="12" class="text-center py-4">Failed to load data.</td></tr></tbody>';
          });
      });

      function initPage(parsed, csvText) {
        const tableEl = $("#OCRTable");

        // Build DataTable columns from CSV headers
        const headers = Object.keys(parsed[0] || {});
        const dtColumns = headers.map((h) => ({ data: h, title: h }));

        // Initialize DataTable
        const dataTable = tableEl.DataTable({
          data: parsed,
          columns: dtColumns,
          responsive: true,
          autoWidth: false,
          deferRender: true,
          pageLength: 10,
        });

        // Add “Component” filter next to the default table filter if a component column exists:
        const compHeaderAliases = [
          "component",
          "Component",
          "ComponentCode",
          "component_code",
        ];
        const componentColIdx = headers.findIndex((h) =>
          compHeaderAliases.includes(h),
        );
        if (componentColIdx !== -1) {
          const componentSet = new Set(
            parsed.map((row) => row[headers[componentColIdx]]).filter(Boolean),
          );
          const filterDiv = $("#OCRTable_filter");
          filterDiv.append(
            `<label style="margin-left:1rem;font-weight:600;">Component:&nbsp;<input type="text" id="componentTableSearch" list="componentTableList" placeholder="component" class="border rounded px-2 py-1 w-24 sm:w-32"></label>`,
          );
          $("body").append('<datalist id="componentTableList"></datalist>');
          componentSet.forEach((c) =>
            $("#componentTableList").append(`<option value="${c}"></option>`),
          );
          $("#componentTableSearch").on("input", function () {
            dataTable.column(componentColIdx).search(this.value).draw();
          });
        }

        // Build a nested data structure keyed by [code][component]["YYYY MMM"]
        const ocrByCodeComp = {};
        const gradeList = ["a*", "a", "b", "c", "d", "e", "u"];
        // Use full month names so they match your session strings
        const monthOrder = {
          January: 1,
          February: 2,
          March: 3,
          April: 4,
          May: 5,
          June: 6,
          July: 7,
          August: 8,
          September: 9,
          October: 10,
          November: 11,
          December: 12,
        };

        parsed.forEach((row) => {
          const yearStr = String(row["year"] || "").trim();
          const sessionStr = String(row["session"] || "").trim();
          const codeStr = String(row["code"] || "").trim();
          const compStr = String(row["component"] || "").trim();
          if (!yearStr || !sessionStr || !codeStr) return;

          const sessionKey = `${yearStr} ${sessionStr}`;

          ocrByCodeComp[codeStr] ??= {};
          ocrByCodeComp[codeStr][compStr || "ALL"] ??= {};
          ocrByCodeComp[codeStr][compStr || "ALL"][sessionKey] ??= {};

          gradeList.forEach((g) => {
            const val = parseFloat(row[g.toUpperCase()] ?? row[g] ?? "");
            if (!isNaN(val)) {
              ocrByCodeComp[codeStr][compStr || "ALL"][sessionKey][g] = val;
            }
          });
          const maxMarkVal = parseFloat(row["max_mark"] ?? "");
          if (!isNaN(maxMarkVal)) {
            ocrByCodeComp[codeStr][compStr || "ALL"][sessionKey]["max_mark"] =
              maxMarkVal;
          }
        });

        const codeInput = document.getElementById("ocrCodeSearch");
        const componentInput = document.getElementById("ocrComponentSearch");
        const codeList = document.getElementById("ocrCodeList");
        const componentList = document.getElementById("ocrComponentList");

        const uniqueCodes = new Set(
          parsed.map((r) => String(r["code"] || "").trim()).filter(Boolean),
        );
        Array.from(uniqueCodes)
          .sort()
          .forEach((c) => {
            codeList.appendChild(
              Object.assign(document.createElement("option"), { value: c }),
            );
          });

        function populateComponentsForCode(code) {
          componentList.innerHTML = "";
          componentInput.value = "";
          componentInput.disabled = true;
          if (!code || !ocrByCodeComp[code]) return;

          const comps = Object.keys(ocrByCodeComp[code]).sort();
          if (!comps.length) return;

          componentInput.disabled = false;
          comps.forEach((compVal) => {
            componentList.appendChild(
              Object.assign(document.createElement("option"), {
                value: compVal,
              }),
            );
          });
          componentInput.value = comps[0];
        }

        const ctx = document.getElementById("OCRChart").getContext("2d");
        let chart = null;
        const gradeColors = {
          "a*": "#2ECC71",
          a: "#F4A261",
          b: "#E9C46A",
          c: "#E63946",
          d: "#264653",
          e: "#6D597A",
          u: "#999999",
        };
        const maxMarkColor = "#555555";

        function updateChart() {
          const codeVal = codeInput.value.trim();
          const compVal = componentInput.value.trim();
          if (
            !codeVal ||
            !compVal ||
            !ocrByCodeComp[codeVal] ||
            !ocrByCodeComp[codeVal][compVal]
          ) {
            if (chart) {
              chart.destroy();
              chart = null;
            }
            return;
          }
          const dataObj = ocrByCodeComp[codeVal][compVal];
          const sessions = Object.keys(dataObj);
          if (!sessions.length) {
            if (chart) {
              chart.destroy();
              chart = null;
            }
            return;
          }

          // Sort "YYYY Month" by year then by full month name
          sessions.sort((a, b) => {
            const [ay, am] = a.split(/\s+/);
            const [by, bm] = b.split(/\s+/);
            const diffYear = +ay - +by;
            if (diffYear !== 0) return diffYear;
            return (monthOrder[am] || 0) - (monthOrder[bm] || 0);
          });

          const hasAstar = sessions.some((sess) => "a*" in dataObj[sess]);
          const gradesToPlot = gradeList.filter((g) => g !== "a*" || hasAstar);

          const datasets = gradesToPlot.map((g) => ({
            label: g.toUpperCase(),
            data: sessions.map((sess) => dataObj[sess][g] ?? null),
            borderColor: gradeColors[g],
            tension: 0.2,
            fill: false,
          }));
          datasets.push({
            label: "Max mark",
            data: sessions.map((sess) => dataObj[sess]["max_mark"] ?? null),
            borderColor: maxMarkColor,
            borderDash: [5, 5],
            borderWidth: 1,
            pointRadius: 0,
            fill: false,
          });

          if (chart) chart.destroy();
          chart = new Chart(ctx, {
            type: "line",
            data: {
              labels: sessions,
              datasets,
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: {
                  display: true,
                  text: `Grade Boundaries — ${codeVal} (${compVal})`,
                },
                legend: { position: "bottom" },
              },
              scales: {
                x: {
                  title: { display: true, text: "Exam Session (Year Month)" },
                },
                y: {
                  beginAtZero: true,
                  title: { display: true, text: "Marks" },
                },
              },
            },
          });
        }

        codeInput.addEventListener("input", () => {
          populateComponentsForCode(codeInput.value.trim());
          updateChart();
        });
        componentInput.addEventListener("input", updateChart);

        const firstCode = Array.from(uniqueCodes).sort()[0] || "";
        codeInput.value = firstCode;
        populateComponentsForCode(firstCode);
        updateChart();

        document.getElementById("downloadCSV").addEventListener("click", () => {
          const blob = new Blob([csvText], { type: "text/csv" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "OCR.csv";
          a.click();
          URL.revokeObjectURL(url);
        });
      }
    </script>

    <!-- 🟢 put this at the BOTTOM of <body> -->

    <script>
      const btn = document.getElementById("theme-toggle");
      const root = document.documentElement;

      /*  swap icon to match current state  */
      btn.textContent = root.classList.contains("dark") ? "☀️" : "🌙";

      btn.addEventListener("click", () => {
        const dark = root.classList.toggle("dark");
        localStorage.setItem("theme", dark ? "dark" : "light");
        btn.textContent = dark ? "☀️" : "🌙";
      });
    </script>
  </body>
</html>
